import{a as i,m as l,u as c}from"./userAuth-BI36wup4.js";function u(){return{tests:[],loading:!1,showForm:!1,flashMessage:null,flashType:"success",totalUsers:0,totalQuestions:0,totalTests:0,totalAnswers:0,newTest:{title:"",description:"",duration:30},editingTest:null,deletingTest:null,toggleForm(){this.showForm=!this.showForm,this.showForm&&this.resetForm()},resetForm(){this.newTest={title:"",description:"",duration:30}},async fetchTests(){this.loading=!0;try{const e=await i.get("/admin/section");this.tests=e.data}catch{this.setFlash("‚ùå Failed to load sections","error")}finally{this.loading=!1}},async addTest(){if(!this.newTest.title){this.setFlash("Title is required","error");return}try{const e=await i.post("/admin/section",{title:this.newTest.title,description:this.newTest.description,duration:this.newTest.duration});this.tests.push(e.data),this.resetForm(),this.showForm=!1,this.setFlash("‚úÖ Section added successfully","success")}catch(e){console.error("‚ùå Failed to add section",e),this.setFlash("‚ùå Failed to add section","error")}},edit(e){this.editingTest={...e}},async updateTest(){try{const e=await i.put(`/admin/section/${this.editingTest.id}`,{title:this.editingTest.title,description:this.editingTest.description,duration:this.editingTest.duration}),s=this.tests.findIndex(t=>t.id===this.editingTest.id);s!==-1&&(this.tests[s]=e.data),this.editingTest=null,this.setFlash("‚úÖ Section updated","success")}catch{this.setFlash("‚ùå Failed to update section","error")}},confirmDelete(e){this.deletingTest=e},async deleteConfirmed(){if(this.deletingTest)try{await i.delete(`/admin/section/${this.deletingTest.id}`),this.tests=this.tests.filter(e=>e.id!==this.deletingTest.id),this.setFlash("‚úÖ Section deleted","success"),this.deletingTest=null}catch{this.setFlash("‚ùå Failed to delete section","error")}},setFlash(e,s="success"){this.flashMessage=e,this.flashType=s,setTimeout(()=>this.flashMessage=null,4e3)},async fetchCounts(){try{const e=await i.get("/admin/stats");this.totalUsers=e.data.users,this.totalQuestions=e.data.questions,this.totalTests=e.data.tests,this.totalAnswers=e.data.answers}catch{this.setFlash("‚ùå Failed to fetch stats","error")}},copySectionId(e){const s=document.createElement("input");s.style.position="absolute",s.style.left="-1000px",s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),this.setFlash(`‚úÖ Section ID ${e} copied`,"success")}}}function h(){return{questions:[],tests:[],selectedTestId:null,editingQuestion:null,deletingQuestion:null,showForm:!1,currentPage:1,lastPage:1,perPage:10,total:0,flashMessage:null,flashType:"success",newQuestion:{question_text:"",test_id:"",answers:[{id:Date.now(),answer_text:"",is_correct:!1},{id:Date.now()+1,answer_text:"",is_correct:!1}]},async fetchQuestions(e=1){try{const s=await i.get("/admin/questions",{params:{page:e,per_page:this.perPage,test_id:this.selectedTestId||void 0}});this.questions=s.data.data,this.currentPage=s.data.current_page,this.lastPage=s.data.last_page,this.total=s.data.total}catch(s){console.error("‚ùå Failed to load questions",s),this.setFlash("‚ùå Failed to load questions","error")}},async filterByTest(e){this.selectedTestId=e,this.currentPage=1,await this.fetchQuestions()},nextPage(){this.currentPage<this.lastPage&&this.fetchQuestions(this.currentPage+1)},prevPage(){this.currentPage>1&&this.fetchQuestions(this.currentPage-1)},setFlash(e,s="success"){this.flashMessage=e,this.flashType=s,setTimeout(()=>{this.flashMessage=null},4e3)},addAnswer(){this.newQuestion.answers.push({id:Date.now()+Math.random(),answer_text:"",is_correct:!1})},removeAnswer(e){this.newQuestion.answers.splice(e,1)},setCorrect(e){this.newQuestion.answers.forEach((s,t)=>{s.is_correct=t===e})},resetForm(){this.newQuestion={question_text:"",test_id:"",answers:[{id:Date.now(),answer_text:"",is_correct:!1},{id:Date.now()+1,answer_text:"",is_correct:!1}]},this.editingQuestion=null,this.showForm=!1},toggleForm(){this.showForm?this.closeForm():(this.resetForm(),this.showForm=!0)},closeForm(){this.showForm=!1,this.resetForm()},edit(e){this.newQuestion={question_text:e.question_text||"",test_id:e.test_id||"",answers:Array.isArray(e.answers)?e.answers.map(s=>({id:Date.now()+Math.random(),answer_text:s.answer_text||"",is_correct:s.is_correct||!1})):[]},this.editingQuestion=e.id},async addQuestion(){if(this.editingQuestion!==null)return;const{question_text:e,test_id:s,answers:t}=this.newQuestion;if(!e.trim()||!s){alert("Question text and test are required");return}if(t.length<2){alert("Please add at least two answers");return}if(t.filter(a=>a.is_correct).length!==1){alert("Please select exactly one correct answer");return}const o={question_text:e,test_id:s,answers:t.map(({answer_text:a,is_correct:n})=>({answer_text:a,is_correct:n}))};try{const a=await i.post("/admin/questions",o);this.setFlash(a.data.message,"success"),this.questions.push({...a.data,answers:Array.isArray(a.data.answers)?a.data.answers:[]}),this.resetForm()}catch(a){console.error("‚ùå Error creating question:",a),this.setFlash("‚ùå Failed to add question","error")}},async updateQuestion(){var e,s,t;try{const r={question_text:this.newQuestion.question_text,test_id:this.newQuestion.test_id,answers:this.newQuestion.answers.map(({answer_text:n,is_correct:d})=>({answer_text:n,is_correct:d}))},o=await i.put(`/admin/questions/${this.editingQuestion}`,r,{headers:{"Content-Type":"application/json"}}),a=this.questions.findIndex(n=>n.id===this.editingQuestion);a!==-1&&(this.questions[a]=o.data.data??o.data),this.setFlash(o.data.message||"‚úÖ Question updated successfully","success"),this.resetForm()}catch(r){console.error("‚ùå Failed to update question",((e=r.response)==null?void 0:e.data)||r),this.setFlash(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"‚ùå Failed to update question","error")}},confirmDelete(e){this.deletingQuestion=e},async deleteConfirmed(){try{await i.delete(`/admin/questions/${this.deletingQuestion.id}`),this.questions=this.questions.filter(e=>e.id!==this.deletingQuestion.id),this.deletingQuestion=null}catch{alert("‚ùå Failed to delete question")}},async deleteAllQuestions(){if(confirm("‚ö†Ô∏è Are you sure you want to delete ALL questions? This cannot be undone."))try{await i.delete("/admin/questions"),this.questions=[],this.setFlash("‚úÖ All questions deleted.","success")}catch(e){console.error("‚ùå Failed to delete all questions",e),this.setFlash("‚ùå Failed to delete all questions.","error")}}}}function f(){return{users:[],availableRoles:[],successMessage:"",deletingUser:null,showForm:!1,errors:[],newUser:{name:"",email:"",password:"",role:""},async fetchUsers(){try{const e=await i.get("/admin/users");this.users=e.data.data||[]}catch(e){console.error("‚ùå Failed to load users",e),alert("Failed to load users")}},async fetchRoles(){try{const e=await i.get("/admin/roles");this.availableRoles=e.data.roles||[]}catch(e){console.error("‚ùå Failed to fetch roles",e)}},async addUser(){var o;this.errors=[];const{name:e,email:s,password:t,role:r}=this.newUser;if(!e||!s||!t||!r){this.errors.push("Please fill in all fields.");return}try{const a=await i.post("/admin/users",{name:e,email:s,password:t,role:r});this.users.push(a.data.user),this.successMessage="‚úÖ User created successfully!",this.newUser={name:"",email:"",password:"",role:""},this.showForm=!1,setTimeout(()=>this.successMessage="",3e3)}catch(a){if(((o=a.response)==null?void 0:o.status)===422){const n=a.response.data.errors;this.errors=Object.values(n).flat()}else a.response?this.errors=[a.response.data.message||"Server error"]:this.errors=["‚ùå Failed to connect to server."];console.error("Add User Error:",a)}},async changeRole(e,s){if(s)try{const t=await i.post(`/admin/users/${e.id}/update-role`,{role:s});e.roles=t.data.user.roles,this.successMessage="‚úÖ Role updated",setTimeout(()=>this.successMessage="",3e3)}catch(t){alert("‚ùå Failed to update role"),console.error(t)}},confirmDelete(e){this.deletingUser=e},async deleteConfirmed(){try{await i.delete(`/admin/users/${this.deletingUser.id}`),this.users=this.users.filter(e=>e.id!==this.deletingUser.id),this.successMessage="üóëÔ∏è User deleted",this.deletingUser=null,setTimeout(()=>this.successMessage="",3e3)}catch(e){alert("‚ùå Failed to delete user"),console.error(e)}}}}function m(){return{settings:{system_name:"",system_description:"",dark_mode_enabled:!1},flashMessage:null,flashType:"success",file:null,async init(){const e=localStorage.getItem("auth_token");e&&(i.defaults.headers.common.Authorization=`Bearer ${e}`)},async saveSystemInfo(){var e;try{const s=await i.post("/settings",this.settings);this.setFlash("‚úÖ Settings saved successfully","success")}catch(s){this.setFlash("‚ùå Error saving settings","error"),console.error(((e=s.response)==null?void 0:e.data)||s.message)}},handleFileUpload(e){this.file=e.target.files[0]},async uploadFile(e){var t;if(!this.file)return alert("Choose a file");const s=new FormData;s.append("file",this.file);try{await i.post(`/import/${e}`,s,{headers:{"Content-Type":"multipart/form-data"}}),this.setFlash("‚úÖ File uploaded successfully","success")}catch(r){this.setFlash("‚ùå Upload failed","error"),console.error(((t=r.response)==null?void 0:t.data)||r.message)}},async deleteAll(e){var s;if(confirm("Are you sure? This cannot be undone."))try{await i.delete(`/delete/${e}`),this.setFlash(`‚úÖ All ${e} deleted successfully`,"success")}catch(t){this.setFlash("‚ùå Delete failed","error"),console.error(((s=t.response)==null?void 0:s.data)||t.message)}},setFlash(e,s="success"){this.flashMessage=e,this.flashType=s,setTimeout(()=>this.flashMessage=null,4e3)}}}function w(){return{currentTab:"questions",loading:!1,sectionManager:u(),questionManager:h(),userManager:f(),systemSettings:m(),copySectionId(e){}}}function p(){return{section:"info",setSection(e){this.section=e}}}function g(){return{name:"",email:"",success:null,error:null,async init(){try{const e=await i.get("/profile");this.name=e.data.name,this.email=e.data.email}catch{this.error="Failed to load profile."}},async updateProfile(){try{await i.patch("/profile",{name:this.name,email:this.email}),this.success="Saved.",this.error=null}catch{this.success=null,this.error="Failed to save changes."}}}}function y(){return{current_password:"",password:"",password_confirmation:"",success:null,error:null,async updatePassword(){var e,s;try{await i.put("/user/password",{current_password:this.current_password,password:this.password,password_confirmation:this.password_confirmation}),this.success="Password updated successfully.",this.error=null,this.current_password="",this.password="",this.password_confirmation=""}catch(t){this.success=null,this.error=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to update password."}}}}function F(){return{showConfirmModal:!1,password:"",error:null,success:null,async deleteAccount(){var e,s;try{await i.delete("/profile",{data:{password:this.password}}),this.success="Account deleted.",this.error=null,localStorage.removeItem("auth_token"),delete i.defaults.headers.common.Authorization,window.location.href="/login"}catch(t){this.error=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete account.",this.success=null}}}}function _(e){e.data("profilePage",p),e.data("infoForm",g),e.data("updatePasswordForm",y),e.data("deleteAccountForm",F)}document.addEventListener("alpine:init",()=>{_(l)});window.Alpine=l;document.addEventListener("alpine:init",()=>{l.store("userAuth",c()),l.data("adminQuizManager",w)});l.start();
